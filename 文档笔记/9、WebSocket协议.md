## 一、WebSocket协议开发

### 1、HTTP协议的弊端

- 1、HTTP协议为半双工协议。半双工协议指数据可以在服务端和服务端两个方向上传输，但不能同时传输。他意味着同一时刻，只有一个方向上的数据传送。
- 2、HTTP消息冗长而繁琐。HTTP消息包含消息头，消息体、换行符等等，通常下采用文本方式传输，相比于其他的二进制通信协议，冗长而繁琐
- 3、针对服务器推送的黑客攻击，列如长时间轮询。

有很多网站实现消息推送采用的技术是长轮询。轮询是在特定时间间隔（如每1秒），由游览器对服务器发出HTTP请求，然后由服务器返回最新的数据给客户端游览器。这种方式很明显的缺点就是需要不断的发出请求，而HTTP请求的Header是非常冗长的，这会占用很多资源和宽带。

​	为了解决HTTP协议效率低下的问题，HTML5定义了Websocket协议，能更好的节省服务器资源和宽带并达到实时通信。



#### 2、WebSocket介绍

​	WebSocket是HTML5开始提供的一种游览器与服务器间进行全双共通信的网络技术，在WebSocketAPI中，游览器和服务器只需要做一个握手的动作，然后，游览器和服务器之间就形成了一条快速的通道，两者就可以直接互相传送数据了。WebSocket基于TCP双向全工进行消息传递，在同一时刻，既可以发消息，也可以接受消息，相比HTTP的半双工协议，性能得到很大提升。特点如下

- 单一的TCP连接，采用全双工模式通信
- 对代理、防火墙和路由器透明
- 无头部消息、Cookie和身份验证
- 无安全开销
- 通过"ping/pong"帧保持链路激活
- 服务器可以主动传递消息给客户端，不再需要客户端轮询。



​	建立WebSocket连接时，需要通过客户端或者游览器发出握手请求。为了建立一个WebSocket连接，客户端游览器首先要向服务器发起一个HTTP请求，这个请求和通常的HTTP请求不同，包含了一些附加头信息，其中附加头信息"Upgrade:WebSocket"表明这是一个申请协议升级的HTTP请求。服务器端解析这些附加的头信息，然后生成应答信息返回给客户端，客户端和服务端的WebSocket连接就建立起来了。这个连接会持续存在直到客户端或者服务端的某一方主动关闭连接。